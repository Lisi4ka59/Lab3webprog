<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
<h:head>
    <title>Lab3 web</title>
    <link rel="stylesheet" href="static/CSS/style.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js" type="text/javascript"/>
</h:head>
<h:outputScript>
    jQuery(function(){
        function countDigits(number) {
            var numberString = number.toString();

            if (numberString.length > 15){
                return true;
            }else{
                return false;
            }
        }
        function valid(){
            let x = jQuery("#vvodx").val();
            let y = jQuery("#vvody").val();

            //jQuery("#group").html(x.lenght());
            if(isNaN(y) || y=="" || countDigits(y) || !((5>=y &amp; y>=-5))){
                vvody.classList.add('invalid');
            }
            if(isNaN(x) || x=="" || !(x==-5 || x==-4 || x==-3 || x==-2 || x==-1 || x==0 || x==1 || x==2 || x==3)){
                vvodx.classList.add('invalid');
            }
            if ((5>=y &amp; y>=-5) &amp; !(isNaN(y) || y=="" || countDigits(y))){
                vvody.classList.remove('invalid');
            }
            if ((x==-5 || x==-4 || x==-3 || x==-2 || x==-1 || x==0 || x==1 || x==2 || x==3 ) &amp; !(isNaN(x) || x=="")){
                vvodx.classList.remove('invalid');
            }
            if ((5>=y &amp; y>=-5) &amp; (x==-5 || x==-4 || x==-3 || x==-2 || x==-1 || x==0 || x==1 || x==2 || x==3) &amp; !(isNaN(y) || y=="" || countDigits(y)) &amp; !(isNaN(x) || x=="")){
                return true;}
            return false;

        };
        function keyevent(){
            if(!valid()){
                jQuery("#submit").prop("disabled", true);
            }else{
                jQuery("#submit").prop("disabled", false);
            }

        };


        jQuery(".xbutton").on("click", function(){jQuery("#vvodx").val(jQuery(this).html());
            event.preventDefault();
            keyevent();});
        jQuery("#vvodx").on("keypress", keyevent);
        jQuery("#vvody").on("keypress", keyevent);
        jQuery("#vvodx").on("change", keyevent);
        jQuery("#vvody").on("change", keyevent);
        jQuery("#vvodx").on("click", keyevent);
        jQuery("#vvody").on("click", keyevent);
        jQuery("#vvodx").on("hover", keyevent);
        jQuery("#vvody").on("hover", keyevent);
        jQuery("#vvodx").on("keyup", keyevent);
        jQuery("#vvody").on("keyup", keyevent);

        jQuery("#forma").on("submit", function(){
            if(!valid()){
                event.preventDefault();
                keyevent();
            };
        });
        //jQuery(".vvod").on("click", keyevent);

    });

</h:outputScript>
<h:body>

<f:view>
    <h:outputLabel value="Hello, world"/>
    <h:form id="inputForm"> X <h:inputText name="inputX" value="#{beanCoordinates.inputX}" id="inputX"/> <h:commandButton action="index"> t </h:commandButton> </h:form>
        <h:form id="graphForm">
            <h:graphicImage id="image" value="GraphicsServlet?x=0#{getData.x}&amp;y=0#{getData.y}" >
                <f:ajax event="click" execute="x y" listener="#{getData.imageclk}" render="panel_2" />
            </h:graphicImage>
            <h:inputHidden id="x" value="#{getData.x}" />
            <h:inputHidden id="y" value="#{getData.y}" />
        </h:form>

        <h:outputScript>
            jQuery("img[id$=':image']").on("mousedown", function(event) {
                var $form = jQuery(this).closest("form");
                $form.find("input[id$=':x']").val(event.pageX - parentOffset.left);
                $form.find("input[id$=':y']").val(event.pageY - parentOffset.top);
                d = new Date();
                $("#graphForm\\:image").attr("src", "GraphicsServlet?x="+event.pageX+"&amp;y="+event.pageY);
            });
        </h:outputScript>
        <h:panelGrid id="panel_2">

            here:#{getData.somedata}
        </h:panelGrid>

    <img src="static/img/back.jpg" alt="back" id="back"/>
    <div class="intro" id="intro"></div>
    <div class="container">
    <div class="data">
        <img src="static/img/capy.jpg" alt="profile" class="profile-pic"/>
        <div class="header-info">
            <p style="font-size: 34px"><b>Mikhail Nachinkin</b></p>
            <p>Группа: P3206</p>
            <p>Вариант: 1734</p>
            <a href="https://vk.com/nachinkin1" ><img src="static/img/VK logo.png" alt="vk" class="contact"/></a>
            <a href="https://github.com/Lisi4ka59" ><img src="static/img/github logo.png" alt="github" class="contact"/></a>
            <a href="https://isu.ifmo.ru/pls/apex/f?p=2437:99:106462222053412" ><img src="static/img/ITMO logo.png" alt="itmo" class="contact"/></a>
        </div>
    </div>
    <form action="ControllerServlet" method="POST" id="forma">

        <div class="xy_table">
            <div id="da">
                <div id="d" >

                </div>
                <div id="resultat">
                </div>
            </div>
            <div class="xy"> <div id="X"> X </div><div class="input"><label for="vvodx"></label><input class="in" type="text" name="X" id="vvodx"/></div> <div class="button"> <button class="xbutton"> -5 </button> <button class="xbutton"> -4 </button>  <button class="xbutton"> -3 </button> <button class="xbutton"> -2 </button>  <button class="xbutton"> -1 </button> <button class="xbutton"> 0 </button>  <button class="xbutton"> 1 </button>  <button class="xbutton"> 2 </button>  <button class="xbutton"> 3 </button> </div>   </div>
            <div class="xy"> <div><label for="vvody">Y</label></div><div class="input"><input class="in" type="text" name="Y" id="vvody"/> </div>  </div>
            <div class="xy"> <div> R </div><div class="input"><label>
                <input class="radi" type="radio" name="R" value="1"/>
            </label> 1
                <label>
                    <input class="radi" type="radio" name="R" value="1.5"/>
                </label> 1.5 <label>
                    <input class="radi" type="radio" name="R" value="2"/>
                </label> 2 <label>
                    <input class="radi" type="radio" name="R" value="2.5"/>
                </label> 2.5 <label>
                    <input class="radi" type="radio" name="R" value="3"/>
                </label> 3 </div>  </div>
            <div class="wrapper">
                <input class="sub" type="submit" value="Submit" id="submit"/>
            </div>


        </div>



    </form>
    <div id="table">
    <table id="res">
    <tr >
        <th style="border-top-left-radius: 10px">Координата Х</th>
        <th>Координата У</th>
        <th>Значение R</th>
        <th>Время столкновения снаряда с объектом</th>
        <th>Время полета снаряда</th>
        <th style="border-top-right-radius: 10px">Результат</th>
    </tr>
    </table>
    </div>
    </div>

    <h:outputScript>
        jQuery(function(){
            var S = +($('input[name="R"]:checked').val());
            $('#d').bind('mousewheel', function(e){
                var wh = (e.originalEvent.wheelDeltaY / 300) + +S;
                S = wh;
                let X = 1000;
                let Y = 1000;
                let R = wh;
                let random = Math.random();
                jQuery("#d").css("background-image", "url('GraphicsServlet?x=" + X + "&amp;y=" + Y + "&amp;r=" + R + "&amp;rand=" + random + " ')");
                e.preventDefault();
            });
            jQuery("#d").click(function (event){
                let parentOffset = jQuery(this).offset();
                let X = event.pageX - parentOffset.left;
                let Y = event.pageY - parentOffset.top;
                let R = S;
                let random = Math.random();
                jQuery("#resultat").load("HitServlet?X=" + X + "&amp;Y=" + Y + "&amp;R=" + R + "&amp;rand=" + random);
                jQuery("#d").css("background-image", "url('GraphicsServlet?x=" + X + "&amp;y=" + Y + "&amp;r=" + R + "&amp;rand=" + random + " ')");
                setTimeout(function () {jQuery("#table").load("TableServlet");}, 10);
            });
            jQuery(".radi").change(function (event) {
                let parentOffset = jQuery(this).offset();
                let X = 1000;
                let Y = event.pageY - parentOffset.top;
                S = $('input[name="R"]:checked').val();
                let R = S;
                let random = Math.random();
                jQuery("#d").css("background-image", "url('GraphicsServlet?x=" + X + "&amp;y=" + Y + "&amp;r=" + R + "&amp;rand=" + random + " ')");
            });
            $(window).on('scroll', function (){
                $('#back').css('top', $(window).scrollTop()/1.5);
            });
        });

    </h:outputScript>

    <h:outputScript src="static/JS/three.r134.min.js"></h:outputScript>
    <h:outputScript src="static/JS/vanta.birds.min.js"></h:outputScript>
    <h:outputScript src="static/JS/app.js"></h:outputScript>
</f:view>
</h:body>
</html>
